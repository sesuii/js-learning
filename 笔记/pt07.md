<!--
 * @Author: _krill
 * @Date: 2022-07-25 16:11:01
 * @LastEditTime: 2022-07-30 00:14:52
 * @Description: 
-->
# Modern JavaScript

## destructure è§£æ„

ä½¿ç”¨ä¸­æ‹¬å·æ¥è§£æ„æ•°ç»„ï¼ŒèŠ±æ‹¬å·è§£æ„å¯¹è±¡

#### è§£æ„æ•°ç»„è¯­æ³•ã€destructuring arraysã€‘

```js
const arr = [2, 3, 4];
const [a, b, c] = arr;

const restaurant = {
  name: 'Classico Italiano',
  location: 'Via Angelo Tavanti 23, Firenze, Italy',
  categories: ['Italian', 'Pizzeria', 'Vegetarian', 'Organic'],
  starterMenu: ['Focaccia', 'Bruschetta', 'Garlic Bread', 'Caprese Salad'],
  mainMenu: ['Pizza', 'Pasta', 'Risotto'],
};const
// è·å– restaurant.categories ä¸­çš„ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œä¸­é—´ç©ºç€
const [first, , third] = restaurant.categories;

// ä¸ä½¿ç”¨ä¸­é—´å˜é‡äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼
[first, third] = [third, first];

// å‡½æ•°è¿”å›æ•°ç»„ï¼Œå°†è¿”å›å€¼ç›´æ¥è§£æ„
const [res1, res2] = f();

// åµŒå¥—æ•°ç»„
const nested = [2, 3, [4, 5]];
const [i, , [j, k]] = nested;

// è®¾ç½®é»˜è®¤å€¼ï¼Œè‹¥æœªè®¾åˆ™ r ä¸º undefined
const [p=1, q=1, r=1] = [1, 2];
```

#### è§£æ„å¯¹è±¡è¯­æ³•ã€destructuring objectsã€‘

```js
const restaurant = {
  name: 'Classico Italiano',
  location: 'Via Angelo Tavanti 23, Firenze, Italy',
  categories: ['Italian', 'Pizzeria', 'Vegetarian', 'Organic'],
  starterMenu: ['Focaccia', 'Bruschetta', 'Garlic Bread', 'Caprese Salad'],
  mainMenu: ['Pizza', 'Pasta', 'Risotto'],

  openingHours: {
    thu: {
      open: 12,
      close: 22,
    },
    fri: {
      open: 11,
      close: 23,
    },
    sat: {
      open: 0, // Open 24 hours
      close: 24,
    },
  },
};

// è§£æ„çš„å˜é‡åç§°ä¸å¯¹è±¡çš„å±æ€§åç§°ç›¸åŒï¼Œæ— éœ€å…³å¿ƒå±æ€§çš„é¡ºåºå…ˆå
const {name, openingHours, categories} = restaurant;

// é‡æ–°å‘½åè§£æ„çš„å˜é‡åç§° ã€å¯¹è±¡å±æ€§å:æ–°å‘½åã€‘
const {name: restaurantName, openingHours: openTime} = restaurant;

// è®¾ç½®é»˜è®¤å€¼
const {name = [], openingHours: open = []};

// å˜å¼‚å˜é‡
let a = 111, b = 222;
const obj = {a: 12, b: 13, c: 14};
// è¿™é‡Œå¿…é¡»ä½¿ç”¨æ‹¬å·ï¼Œå¦åˆ™èŠ±æ‹¬å·å†…å®¹å°†ä¼šç›´æ¥ç»“æŸ
({a, b} = obj)

// åµŒå¥—å¯¹è±¡
const {fri: {open, close}} = openingHours;

// å‡½æ•°è°ƒç”¨æ—¶è§£æ„å‚æ•°å¯¹è±¡ï¼Œä¼ å…¥ä¸€ä¸ªå¯¹è±¡å®å‚ï¼Œåœ¨å‡½æ•°å½¢å‚å¤„å°†å…¶è§£æ„
```

## æ‰©å±•è¿ç®—ç¬¦ `...`

æ‰©å±•è¿ç®—ç¬¦å¯ç”¨äºæ‰€æœ‰å¯è¿­ä»£å¯¹è±¡ï¼Œå¯è¿­ä»£çš„å¯¹è±¡åŒ…æ‹¬æ˜¯æ•°ç»„ã€å­—ç¬¦ä¸²ã€æ˜ å°„ã€é›†åˆï¼Œä¸åŒ…æ‹¬å¯¹è±¡ã€‚

ES2018 ä»¥åï¼Œæ‰©å±•è¿ç®—ç¬¦åŒæ ·å¯ç”¨äºå¯¹è±¡ï¼Œå³ä¾¿è¯¥å¯¹è±¡æ˜¯ä¸å¯è¿­ä»£çš„ã€‚

**æ‰©å±•è¿ç®—ç¬¦ä¸€èˆ¬ç”¨äºåˆ›å»ºæ–°çš„æ•°ç»„ä»¥åŠä¼ é€’å¤šä¸ªå‡½æ•°å‚æ•°ã€‚**

```js
// æ‰©å±•ç”Ÿæˆæ–°çš„æ•°ç»„
const arr = [4, 5, 6];
const newArr = [1, 2, 3, ...arr];
console.log(...newArr);

// æ•°ç»„çš„æµ…æ‹·è´
const mainMenuCopy = [...restaurant.mainMenu];

// ä¸¤ä¸ªæ•°ç»„çš„åˆå¹¶
const menu = [...restaurant.mainMenu, ...restaurant.starterMenu];

// å­—ç¬¦ä¸²
const str = 'gerry';
const letters = [...str, ' ', 'hello'];

// å¯¹è±¡
const newRestaurant = {upYear: 2022, ...restaurant, newAddr: "China"};

```

## Rest Pattern and Parameters `...`

å‰©ä½™æ¨¡å¼å’Œæ‰©å±•è¿ç®—ç¬¦æ‰€ä½¿ç”¨çš„ç¬¦å·ç›¸åŒï¼Œä½†ä½œç”¨å®Œå…¨ç›¸åï¼Œåˆ›å»ºæ–°çš„æ•°ç»„æ—¶æ‰©å±•è¿ç®—ç¬¦çš„ä½œç”¨ä¸ºè§£åŒ…ä¸€ä¸ªæ•°ç»„å°†å…¶åˆ†æ•£æˆå•ä¸ªå…ƒç´ ï¼Œè€Œ rest æ˜¯å°†å…ƒç´ æ‰“åŒ…æˆä¸€ä¸ªæ•°ç»„ã€‚

æ‰©å±•è¿ç®—ç¬¦ä¸€èˆ¬åœ¨èµ‹å€¼è¿ç®—ç¬¦ `=` çš„å³è¾¹å‡ºç°ï¼Œå‰©ä½™æ¨¡å¼ä¸€èˆ¬åœ¨èµ‹å€¼è¿ç®—ç¬¦çš„å·¦è¾¹å‡ºç°

```js
// Rest Pattern åªèƒ½ç”¨äºæœ€åä¸”åªæœ‰ä¸€ä¸ª
const [a, b, ...others] = [1, 2, 3, 4, 5];

const [pizza, , risotto, ...otherFood] = [...restaurant.mainMenu, ...restaurant.starterMenu];

// å‡½æ•° rest parameters
const add = function (...numbers) {
    let ans = 0;
    for (let i = 0; i < numbers.length; i++)
        ans += numbers[i];
    return ans;
}
add(1, 2);
add(45, 3, 2, 32, 1);
add(...arr);

```

## Short Curcuiting çŸ­è·¯

é€»è¾‘è¿ç®—ç¬¦ï¼š`||` å¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºçœŸå€¼ï¼Œåˆ™ä¸ä¼šæ£€éªŒç¬¬äºŒä¸ªæ¡ä»¶ï¼›`&&` å¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºå‡å€¼ï¼Œåˆ™ä¸æ£€éªŒç¬¬äºŒä¸ªæ¡ä»¶ï¼›

1. å¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹å¹¶ä¸”è¿”å›ä»»ä½•ç±»å‹
```js
// å¦‚æœç¬¬ä¸€ä¸ªå€¼æ˜¯çœŸå€¼ï¼Œé‚£ä¹ˆç«‹å³è¿”å›ç¬¬ä¸€ä¸ªå€¼
console.log(3 || 'gerry');

---
output:
> 3
```

## Nullish Coalescing Operator æ— æ•ˆåˆå¹¶å‡½æ•° `??` ES2020

åŠŸèƒ½å’Œè¿ç®—ç¬¦ `||` ç±»ä¼¼ï¼Œä½†æ”¯æŒæ— æ•ˆå€¼å¹¶éå‡å€¼ï¼Œåœ¨ `||` å°† 0 åˆ¤æ–­ä¸ºå‡ï¼Œè€Œæ— æ•ˆå€¼ Nullish æ˜¯æŒ‡ `null` å’Œ `undefined`ã€‚

``` js
restaurant.numGuests = 0;
const guests = restaurant.numGuest || 10;
const guestsCorrect = restaurant.numGuest ?? 10;

---
output:
> 10
> 0

```

## ModernJS Assignment Operator ES2021

```js 
const rest1 = {
  name: 'Capri',
  numGuests: 0,
};
const rest2 = {
  name: 'La Pizza',
  owner: 'Gossip',
};

// å±æ€§ä¸å­˜åœ¨åˆ™ä¼šåˆ›å»º undefined => 10
rest1.numGuests ||= 10;
rest2.numGuests ||= 10;

// undefined => 0
rest1.numGuests ??= 10;
rest2.numGuests ??= 10;

// å¦‚æœè¯¥å±æ€§å­˜åœ¨åˆ™èµ‹å€¼ä¸º <ANONYMOUS>ï¼Œå¦‚æœåŸå…ˆä¸å­˜åœ¨åˆ™ä¸ä¼šåˆ›å»ºå’Œèµ‹å€¼
rest1.owner &&= "<ANONYMOUS>";
rest2.owner &&= "<ANONYMOUS>";
```

## for-of loop Array ES6

å¾ªç¯æ•°ç»„
```js
for(const item of menu) console.log(item);
for(const item of menu.entries()) console.log(item);
console.log([...menu.entries()]);
for(const [i, el] of menu.entries()) console.log(i, el);
```

å¾ªç¯å¯¹è±¡
```js
// è·å–å¯¹è±¡ä¸­çš„å±æ€§åç§°
for (const day of Object.keys(openingHours)) {
  console.log(day);
}

// è·å–å¯¹è±¡ä¸­å±æ€§çš„å€¼
for (const detail of Object.values(openingHours)) {
  console.log(detail);
}

// Entries
const entries = Object.entries(openingHours);
for (const (key, {open, close}) of entries) {
  console.log(k, open, close);
}

```

## Enhanced Object Literals

```js
const index = 1;
const weekdays = ['Mon', 'Tues', 'Wed', 'Thur', 'Fri', 'Sat', 'Sun'];
const openingHours: {
  // 3. è®¡ç®—å±æ€§å
  [weekdays[3]]: {
    open: 12,
    close: 22,
  },
  [weekdays[4]]: {
    open: 11,
    close: 23,
  },
  [`day-${index}`]: {
    open: 0, // Open 24 hours
    close: 24,
  },
};
const restaurant = {
  name: 'Classico Italiano',
  location: 'Via Angelo Tavanti 23, Firenze, Italy',
  categories: ['Italian', 'Pizzeria', 'Vegetarian', 'Organic'],
  starterMenu: ['Focaccia', 'Bruschetta', 'Garlic Bread', 'Caprese Salad'],
  // 1. ç®€å•æ·»åŠ å¯¹è±¡å±æ€§  
  openingHours,
  mainMenu: ['Pizza', 'Pasta', 'Risotto'],
  // 2. ç®€åŒ–å¯¹è±¡æ–¹æ³•çš„å†™æ³•
  printMenu (menuIndex) {
    ...
    console.log(menuIndex);
  }
};

```

## Optional chaining å¯é€‰é“¾æ¥ ES2020

å½“å¤šå±‚åµŒå¥—äº†å¾ˆå¤šä¸ªå±æ€§æ—¶ï¼Œå€˜è‹¥ä¹‹å‰çš„å±æ€§æ˜¯ undefinedï¼Œé‚£ä¹ˆ `undefined.properties` å°†ä¼šæŠ¥é”™ï¼Œå¯ä»¥ç”¨ `if-else` å…ˆåˆ¤æ–­ï¼Œä½†å½“æœ‰å¤šå±‚æ—¶ä¼šå˜å¾—éå¸¸éº»çƒ¦ï¼Œäºæ˜¯ ES2020 å¼•å…¥å¯é€‰é“¾æ¥ï¼Œå½“é‡åˆ°æ— æ•ˆå€¼ï¼ˆnull, undefinedï¼‰æ—¶ç›´æ¥è¿”å›ã€‚

```js
// 1. åŸå§‹
if (restaurant.openingHours && restaurant.openingHours.mon) console.log(restaurant.openingHours.mon.open);

// å¯é€‰é“¾æ¥-å¯¹è±¡å±æ€§
const open = restaurant.openingHours?.mon?.open ?? 'closed';

// å¯é€‰é“¾æ¥-è°ƒç”¨æ–¹æ³•
console.log(restaurant.order?.(1, 2) && "Method doesn't exit");

// å¯é€‰é“¾æ¥-æ•°ç»„
const users = [{name: 'gerry', age: 12}];
console.log(user[0]?.name);
```

## Set é›†åˆ

### Basic

é›†åˆæ²¡æœ‰ç´¢å¼•ï¼Œä¸èƒ½ä½¿ç”¨ä¸‹æ ‡è®¿é—®

```js
// åˆ›å»ºé›†åˆï¼Œä¼ å…¥å‚æ•°ä¸ºå¯è¿­ä»£å¯¹è±¡ï¼Œå…ƒç´ æ˜¯ç‹¬ä¸€æ— äºŒçš„
const ordersSet = new Set(['Pizza', 'Paste', 'Pizza', 'Risotto', 'Pizza', 'Paste']);
// é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•° :3
ordersSet.size
// å­—ç¬¦ä¸²ä¹Ÿæ˜¯å¯è¿­ä»£çš„
console.log(new Set('gerry'));
// æ£€æŸ¥é›†åˆä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´  true/false
ordersSet.has('Pizza');
// æ·»åŠ å…ƒç´ 
ordersSet.add('Monita');
// åˆ é™¤å…ƒç´ 
ordersSet.delete('Monita');
// æ¸…ç©ºé›†åˆ
ordersSet.clear();
// é›†åˆæ˜¯å¯è¿­ä»£çš„ï¼Œfor éå†
for (const order of OrderSet) {
  console.log(order);
}
```

### åœºæ™¯

#### 1. å»é™¤æ•°ç»„ä¸­çš„é‡å¤å€¼ => å¾—åˆ°å»é‡åçš„æ•°ç»„

```js
const staff = ['waiter', 'chef', 'manager', 'waiter', 'waiter', 'chef'];
const staffUnque = [...new Set(staff)];
```

#### 2. ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­ä¸åŒå­—æ¯ä¸ªæ•°

```js
const str = 'aaaabcdefggggh';
const count = new Set(str).size;
```

## map æ˜ å°„

key to value çš„æ˜ å°„
map ä¸å¯¹è±¡çš„åŒºåˆ«åœ¨äºå¯¹è±¡çš„é”®åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œ map çš„é”®å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ã€‚

### Basic

```js
const rest = new Map();

// æ·»åŠ é”®å€¼å¯¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé”®ï¼Œç¬¬äºŒä¸ªä¸ºå€¼ã€‚è¿”å›å€¼ä¸ºæ›´æ–°åçš„é›†åˆ
rest.set('name', 'Italy')
    .set(1, 'Classic')
    .set(true, "we're open :D"),
    .set(false, "we're closed :(");

// è·å– valueï¼Œå‚æ•°ä¸º key
rest.get('name');
// ä»¥ä¸Šè®¾ç½®äº†å¸ƒå°”å€¼ä½œä¸ºé”®ï¼Œåˆ™å¯ä»¥å†™å…¥é€»è¾‘è¡¨è¾¾å¼ä½œä¸ºå‚æ•°
rest.get('<é€»è¾‘è¡¨è¾¾å¼ T/F>');
// åˆ é™¤å…ƒç´ ï¼Œå‚æ•°ä¸º key
rest.delete('name');
// é”®å€¼å¯¹ä¸ªæ•°
rest.size;
// åˆ é™¤æ‰€æœ‰å…ƒç´ 
rest.clear();

// å¦‚æœé”®æ˜¯æ•°ç»„/å¯¹è±¡ï¼Œé”™è¯¯åšæ³•
rest.set([1, 2], 'array yep');
rest.get([1, 2]); // è¿™æ ·æ— æ³•å–å¾—å€¼ï¼Œå› ä¸ºæ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡
// æ­£ç¡®åšæ³•
const arr = [1, 2];
rest.set(arr, 'array yep');
rest.get(arr);
```

### åœºæ™¯

#### 1. å°†å¯¹è±¡è½¬æ¢ä¸ºæ˜ å°„
```js
const hoursMap = new Map(Object.entries(openingHours));
```

#### 2. for-loop éå†
```js
for (const [k, v] of hoursMap) console(k, v);
```

#### 3. å°†æ˜ å°„è½¬æ¢ä¸ºæ•°ç»„
```js
const hoursArr = [...hoursMap];
const hoursEntries = [...hoursMap.entries()];
const hoursKeys = [...hoursMap.keys()];
const hoursValues = [...hoursMap.values()];
```

## å››ç§å†…ç½®æ•°æ®ç»“æ„[array, set, map, object]çš„é€‰æ‹©

### Array VS. Set å•å€¼

- å½“éœ€è¦å­˜å‚¨çš„å€¼æ˜¯æœ‰åºçš„ï¼Œå¹¶ä¸”ä¸è¦æ±‚å”¯ä¸€æ—¶ä½¿ç”¨æ•°ç»„

- å½“å¯¹å­˜å‚¨çš„å€¼æœ‰é¢‘ç¹çš„æ“ä½œæ—¶ä½¿ç”¨æ•°ç»„

- å½“å¸Œæœ›å­˜å‚¨çš„å€¼æ˜¯å”¯ä¸€çš„æ—¶ä½¿ç”¨é›†åˆ

- æŸäº›éœ€è¦é«˜æ€§èƒ½çš„åº”ç”¨åœºæ™¯ï¼Œé›†åˆåœ¨å»é‡å’Œæœç´¢ä¸Šæ¯”æ•°ç»„å¿«å¾—å¤š

### Map VS. Object é”®å€¼å¯¹

- æ˜ å°„å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€æ›´æ˜“äºå¯è¿­ä»£ã€æ–¹ä¾¿è®¡ç®—å®¹é‡ï¼Œå¦‚æœä»…ä»…éœ€è¦ç®€å•çš„é”®å€¼å¯¹æ—¶ä½¿ç”¨æ˜ å°„

- å½“é”®ä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²ç±»å‹æ—¶ä½¿ç”¨æ˜ å°„

- å½“éœ€è¦å‡½æ•°ä½œä¸ºå€¼æ—¶ä½¿ç”¨å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ `this` å…³é”®å­—

- å¤„ç† JSON æ•°æ®æ—¶ä½¿ç”¨å¯¹è±¡

## String å­—ç¬¦ä¸²

### Basic

```js
const airline = 'TAP Air Portugal';
const plane = 'A320';

// indexOf å‚æ•°ä¸ºå­—ç¬¦ï¼Œè¿”å›å­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡
airline.indexOf('r');
// å­—ç¬¦æœ€åä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡
airline.lastIndexOf('r');
// è¿”å›å­—ç¬¦ä¸²é¦–å­—æ¯ç¬¬ä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡
airline.indexOf('Air');
// åˆ‡ç‰‡ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå¼€å§‹çš„ä¸‹æ ‡ beginï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç»“æŸçš„ä¸‹æ ‡ endï¼Œlength = end - begin
airline.slice(4, 7);
airline.slice(-5); // ä»åå¾€å‰è®¡æ•°
// æå–å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå•è¯
airline.slice(0, airline.indexOf(' '));
airline.slice(airline.lastIndexOf(' ') + 1);
// å»é™¤å­—ç¬¦ä¸²å‰åçš„ç©ºç™½å­—ç¬¦
airline.trim();
// æ›¿æ¢ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºéœ€è¦æ›¿æ¢çš„å­—ç¬¦/å­—ä¸²ï¼Œç¬¬äºŒä¸ªä¸ºæ›¿æ¢çš„å­—ç¬¦/å­—ä¸²
airline.replace('r', 'X');
// nodejs v18 æ”¯æŒ replaceAll()
airline.replace(/r/g, 'X');
// åˆ¤æ–­æ˜¯å¦åŒ…å«å­—ä¸²ï¼Œè¿”å›å¸ƒå°”å€¼
airline.includes(substr);
airline.startWith(headSubstr);
airline.endWith(endSubstr);
// åˆ‡å‰²ï¼Œè¿”å›æ•°ç»„
airline.split(' ');
// åˆ‡å‰²å’Œç»„åˆ
const name = ['Miss.', firstName, LastName.toUpperCase()].join(' ');
// é¦–å­—æ¯å¤§å†™çš„ä¸¤ç§æ–¹æ³•
const nameUpper = name[0].toUpperCase() + name.slice(1);
const nameUpper1 = name.replace(name[0], name[0].toUpperCase());
// padding å¡«å……å­—ç¬¦ä¸²
const message = 'what do you mean';
// åœ¨å­—ç¬¦ä¸²å¼€å¤´å¡«å……ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæœŸæœ›é•¿åº¦ï¼Œç¬¬äºŒä¸ªä¸ºå¡«å……çš„å­—ç¬¦/ä¸²
message.padStart(25, 'x');
message.padStart(25, 'x'); // åœ¨å­—ç¬¦ä¸²æœ«å°¾å¡«å……ï¼Œå‚æ•°åŒä¸Š
// é‡å¤ repeatï¼Œå‚æ•°ä¸ºé‡å¤çš„æ¬¡æ•°
message.repeat(3);
const planeInLine = function (cnt) {
  console.log(`There're ${cnt} planes in line ${'ğŸ›¬'.repeat(cnt)}`);
}
// åœºæ™¯1 éšè—é“¶è¡Œå¡å·
const maskCreditCard = function (number) {
  const str = number + '';
  const last = str.slice(-4);
  return str.padStart(str.length, '*');
}
```